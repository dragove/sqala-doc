(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{312:function(a,t,s){"use strict";s.r(t);var e=s(14),n=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"sql风格查询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sql风格查询"}},[a._v("#")]),a._v(" SQL风格查询")]),a._v(" "),s("p",[a._v("除了集合风格查询外，sqala还支持类似SQL风格的查询DSL，首先我们需要做一些准备：")]),a._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("sqala"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dsl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" people "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" asTable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),s("p",[a._v("我们需要使用"),s("code",[a._v("asTable")]),a._v("方法将实体类转换为表结构，以便后续查询中使用。")]),a._v(" "),s("h2",{attrs:{id:"构建查询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建查询"}},[a._v("#")]),a._v(" 构建查询")]),a._v(" "),s("p",[a._v("sqala的查询使用"),s("code",[a._v("query from")]),a._v("方法构建，"),s("code",[a._v("from")]),a._v("的参数是使用"),s("code",[a._v("asTable")]),a._v("创建的表结构：")]),a._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" query from people\n")])])]),s("p",[a._v("查询返回的数据类型为：")]),a._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" result"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" List"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("fetch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("q"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("h2",{attrs:{id:"投影"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#投影"}},[a._v("#")]),a._v(" 投影")]),a._v(" "),s("p",[s("code",[a._v("select")]),a._v("方法用于生成数据投影，其参数是"),s("a",{attrs:{href:"https://wz7982.github.io/sqala-doc/expr/",target:"_blank",rel:"noopener noreferrer"}},[a._v("表达式"),s("OutboundLink")],1),a._v("或其组成的元组、命名元组：")]),a._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" query from people select "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("p",[a._v("查询返回的数据为：")]),a._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" result"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" List"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[a._v("Int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[a._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("fetch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("q"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("p",[a._v("使用"),s("code",[a._v("selectDistinct")]),a._v("对结果集去重：")]),a._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" query from people selectDistinct "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("h2",{attrs:{id:"过滤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#过滤"}},[a._v("#")]),a._v(" 过滤")]),a._v(" "),s("p",[a._v("使用"),s("code",[a._v("where")]),a._v("方法进行条件过滤，参数是一个"),s("code",[a._v("Boolean")]),s("a",{attrs:{href:"https://wz7982.github.io/sqala-doc/expr/",target:"_blank",rel:"noopener noreferrer"}},[a._v("表达式"),s("OutboundLink")],1),a._v("：")]),a._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" id "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" query from people where people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" id select "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("p",[s("strong",[a._v("多次调用"),s("code",[a._v("where")]),a._v("时将会使用AND来连接查询条件。")])]),a._v(" "),s("p",[a._v("对于动态拼接的条件，sqala提供了"),s("code",[a._v("whereIf")]),a._v("方法，会在第一个参数值为"),s("code",[a._v("true")]),a._v("时使用"),s("code",[a._v("AND")]),a._v("才将条件拼接到查询中：")]),a._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" id "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"小黑"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("query from people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("whereIf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("whereIf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("nonEmpty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("p",[s("strong",[s("code",[a._v("filter")]),a._v("不会改变查询结果类型。")])]),a._v(" "),s("h2",{attrs:{id:"表连接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#表连接"}},[a._v("#")]),a._v(" 表连接")]),a._v(" "),s("p",[a._v("使用"),s("code",[a._v("join")]),a._v("、"),s("code",[a._v("leftJoin")]),a._v("、"),s("code",[a._v("rightJoin")]),a._v("来处理表连接，并使用"),s("code",[a._v("on")]),a._v("来处理连接条件，并将其放入"),s("code",[a._v("from")]),a._v("方法中：")]),a._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("\n    query from "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("a join b on a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("id join c on b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("p",[a._v("此时返回的结果类型为：")]),a._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" result"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" List"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("A"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" C"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("fetch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("q"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("p",[a._v("由于外连接会产生额外的空值，因此，sqala可以从表连接的信息中自动推断返回类型，如果我们把上面的查询改为先进行右连接再进行左连接：")]),a._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("\n    query from "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("a rightJoin b on a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("id leftJoin c on b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" c"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("p",[a._v("此时返回的结果类型变成了：")]),a._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" result"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" List"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Option"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("A"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" Option"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("C"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("fetch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("q"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("p",[a._v("这里显式写出了返回类型仅仅是为了演示，sqala会从查询中自动推断出合适的返回类型。")]),a._v(" "),s("p",[a._v("对于自连接的情况，我们使用"),s("code",[a._v("as")]),a._v("方法给表起别名，比如有一个存储部门树的表对象：")]),a._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" Department"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n    id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[a._v("Int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    parentId"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[a._v("Int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[a._v("String")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" department "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" asTable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("Department"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),s("p",[a._v("我们可以这样来关联查询：")]),a._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" d1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" department as "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"d1"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" d2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" department as "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"d2"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" query from "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("d1 leftJoin d2 on d1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("parentId "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" d2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("p",[s("strong",[a._v("请注意，在同一个查询中，出现的表别名不能重复，否则会产生编译错误。")])]),a._v(" "),s("h2",{attrs:{id:"分组"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分组"}},[a._v("#")]),a._v(" 分组")]),a._v(" "),s("p",[a._v("使用"),s("code",[a._v("groupBy")]),a._v("配合聚合函数表达式进行分组操作：")]),a._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n    query\n        from people\n        groupBy "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("gender"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        select "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" gender "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("gender"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" count "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" maxBirthday "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" max"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("birthday"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("p",[a._v("另外可以使用"),s("code",[a._v("having")]),a._v("过滤聚合出的数据：")]),a._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n    query\n        from people\n        groupBy "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("gender"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        having count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n        select "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" gender "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("gender"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" count "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" maxBirthday "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" max"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("birthday"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("h2",{attrs:{id:"排序"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#排序"}},[a._v("#")]),a._v(" 排序")]),a._v(" "),s("p",[a._v("使用"),s("code",[a._v("orderBy")]),a._v("方法进行排序，参数是使用"),s("code",[a._v("asc")]),a._v("或"),s("code",[a._v("desc")]),a._v("方法生成的排序规则：")]),a._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" query from people orderBy "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("asc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("desc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("p",[s("strong",[s("code",[a._v("sortBy")]),a._v("不会改变查询结果类型")])]),a._v(" "),s("h2",{attrs:{id:"子查询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#子查询"}},[a._v("#")]),a._v(" 子查询")]),a._v(" "),s("p",[a._v("sqala支持"),s("a",{attrs:{href:"https://wz7982.github.io/sqala-doc/expr/",target:"_blank",rel:"noopener noreferrer"}},[a._v("表达式"),s("OutboundLink")],1),a._v("中的子查询和"),s("code",[a._v("JOIN")]),a._v("中的表子查询，首先来介绍表达式中的子查询：")]),a._v(" "),s("p",[a._v("返回一列数据的子查询可以作为表达式的一部分出现，比如：")]),a._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" subQuery "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" query from people select max"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("birthday"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" query from people where people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("birthday "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" subQuery\n")])])]),s("p",[a._v("支持"),s("code",[a._v("IN")]),a._v("、"),s("code",[a._v("ANY")]),a._v("、"),s("code",[a._v("SOME")]),a._v("、"),s("code",[a._v("ALL")]),a._v("、"),s("code",[a._v("EXISTS")]),a._v("等子查询相关谓词：")]),a._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" subQuery "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" query from people where people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"小黑"')]),a._v(" select people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("id\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" q1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" query from people where people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" any"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("subQuery"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" q2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" query from people where people"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("in"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("subQuery"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("p",[a._v("使用"),s("code",[a._v("as")]),a._v("给查询起别名之后，我们可以将其放入"),s("code",[a._v("from")]),a._v("的表中：")]),a._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" t1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" query from b select "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("x "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" y "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" as "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"t1"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" query from "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("a leftJoin t1 on a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("x "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" t1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" select "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ay "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" by "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" t1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("p",[s("strong",[a._v("作为表的子查询必须将其投影成"),s("code",[a._v("命名元组（NamedTuple）")])]),a._v("，使用"),s("code",[a._v("命名元组（NamedTuple）")]),a._v("给字段起名之后，就可以在后续使用字段名引用对应的字段。")]),a._v(" "),s("h2",{attrs:{id:"集合操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#集合操作"}},[a._v("#")]),a._v(" 集合操作")]),a._v(" "),s("p",[a._v("sqala支持使用"),s("code",[a._v("union")]),a._v("、"),s("code",[a._v("unionAll")]),a._v("、"),s("code",[a._v("intersect")]),a._v("、"),s("code",[a._v("intersectAll")]),a._v("、"),s("code",[a._v("except")]),a._v("、"),s("code",[a._v("exceptAll")]),a._v("等方法来处理集合查询，此类操作的使用方法与集合风格查询类似，不再赘述。")])])}),[],!1,null,null,null);t.default=n.exports}}]);