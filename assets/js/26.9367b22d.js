(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{311:function(t,a,s){"use strict";s.r(a);var e=s(14),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"表达式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#表达式"}},[t._v("#")]),t._v(" 表达式")]),t._v(" "),s("p",[t._v("为了更好地使用sqala处理业务，我们最好对sqala的表达式有一些了解。")]),t._v(" "),s("p",[t._v("sqala中包含了一个SQL语法树，并在编译期读取Scala本身的语法树，转换到SQL语法树，因此，sqala拥有强大的表达力。")]),t._v(" "),s("h2",{attrs:{id:"字段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#字段"}},[t._v("#")]),t._v(" 字段")]),t._v(" "),s("p",[t._v("字段是最基本的表达式之一，我们在查询构建中使用的字段就是字段表达式：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// id是一个字段类型的表达式")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"值"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#值"}},[t._v("#")]),t._v(" 值")]),t._v(" "),s("p",[t._v("除了字段外，值表达式也是最基本的表达式，比如一些需求需要把一个固定的值作为结果的一列：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"a"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"逻辑、关系运算"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#逻辑、关系运算"}},[t._v("#")]),t._v(" 逻辑、关系运算")]),t._v(" "),s("p",[t._v("除了字段和值之外，构造查询最常用的就是逻辑运算与关系运算表达式，它常用于查询表达式的"),s("code",[t._v("filter")]),t._v("、"),s("code",[t._v("on")]),t._v("、"),s("code",[t._v("having")]),t._v("等方法中。")]),t._v(" "),s("p",[t._v("sqala支持以下的符号运算符：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("运算符名称")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("对应SQL运算符")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("==")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("=")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("!=")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("<>")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v(">")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v(">")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v(">=")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v(">=")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("<")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("<")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("<=")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("<=")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("&&")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("AND")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("||")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("OR")])])])])]),t._v(" "),s("p",[t._v("比如：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"小黑"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("如果"),s("code",[t._v("==")]),t._v("或"),s("code",[t._v("!=")]),t._v("的右侧值是"),s("code",[t._v("None")]),t._v("，则对应SQL的"),s("code",[t._v("IS NULL")]),t._v("和"),s("code",[t._v("IS NOT NULL")])]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// a.x IS NULL ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("A"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" None"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// a.x IS NOT NULL ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("A"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" None"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("为了使"),s("code",[t._v("!=")]),t._v("与编程语言语义一致，sqala会进行语义优化：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// a.x <> 1 OR a.x IS NULL")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("A"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("运算符的右侧不仅可以是普通的值，也可以是另一个表达式，比如它可以放在"),s("code",[t._v("ON")]),t._v("条件里：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("A"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("值表达式也可以轻易地放在一个二元运算的左侧：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("除了这些符号组成的运算符，sqala还支持一些非符号的运算符：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("运算符名称")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("对应SQL运算符")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("in")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("IN")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("between")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("BETWEEN")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("like")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("LIKE")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("contains")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("LIKE '%xxx%'")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("startsWith")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("LIKE 'xxx%'")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("endsWith")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("LIKE '%xxx'")])])])])]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" ids "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" List"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("in"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ids"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("like"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"小%"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("code",[t._v("in")]),t._v("运算在传入一个空列表时，为避免生成错误SQL，此谓词会被优化成"),s("code",[t._v("FALSE")]),t._v("。")]),t._v(" "),s("p",[s("code",[t._v("in")]),t._v("运算可以也传入一个类型相符的表达式元组，而非值列表：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("in"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("使用"),s("code",[t._v("!")]),t._v("创建一元逻辑运算：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("对"),s("code",[t._v("in")]),t._v("、"),s("code",[t._v("between")]),t._v("、"),s("code",[t._v("like")]),t._v("、"),s("code",[t._v("exists")]),t._v("等运算符使用逻辑运算"),s("code",[t._v("!")]),t._v("，会生成对应的"),s("code",[t._v("NOT IN")]),t._v("、"),s("code",[t._v("NOT BETWEEN")]),t._v("、"),s("code",[t._v("NOT LIKE")]),t._v("、"),s("code",[t._v("NOT EXISTS")]),t._v("运算符，而非一元运算。")]),t._v(" "),s("h2",{attrs:{id:"导入given"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#导入given"}},[t._v("#")]),t._v(" 导入given")]),t._v(" "),s("p",[t._v("如果需要比较的表达式有不同的数据类型，比如"),s("code",[t._v("Int")]),t._v("和"),s("code",[t._v("Option[Long]")]),t._v("的比较、"),s("code",[t._v("LocalDateTime")]),t._v("和"),s("code",[t._v("String")]),t._v("的比较等；")]),t._v(" "),s("p",[t._v("或是使用"),s("code",[t._v("like")]),t._v("、"),s("code",[t._v("between")]),t._v("等运算符。")]),t._v(" "),s("p",[t._v("需要导入：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("sqala"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("static"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dsl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("given")]),t._v("\n")])])]),s("p",[t._v("方能使表达式成立。")]),t._v(" "),s("p",[t._v("这些"),s("code",[t._v("given")]),t._v("实例均引用了一个"),s("code",[t._v("QueryContext")]),t._v("的上下文参数，因此不会在"),s("code",[t._v("queryContext")]),t._v("作用域之外使用时通过编译，不会污染其他非查询构造代码。")]),t._v(" "),s("h2",{attrs:{id:"多列比较"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#多列比较"}},[t._v("#")]),t._v(" 多列比较")]),t._v(" "),s("p",[t._v("sqala也允许多列同时参与关系运算：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"小黑"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("in"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("List"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"小黑"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"小白"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q3 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("in"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"数值运算"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数值运算"}},[t._v("#")]),t._v(" 数值运算")]),t._v(" "),s("p",[t._v("sqala支持以下数值运算符：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("运算符名称")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("对应SQL运算符")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("+")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("+")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("-")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("-")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("*")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("*")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("/")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("/")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("%")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("%")])])])])]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" \n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("以及一元运算"),s("code",[t._v("+")]),t._v("和"),s("code",[t._v("-")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" \n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#函数"}},[t._v("#")]),t._v(" 函数")]),t._v(" "),s("p",[t._v("sqala内置了一些常用函数")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("函数名称")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("对应SQL函数")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("coalesce")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("COALESCE")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("ifnull")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("COALESCE")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("nullif")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("NULLIF")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("abs")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("ABS")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("ceil")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("CEIL")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("floor")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("FLOOR")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("round")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("ROUND")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("power")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("POWER")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("concat")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("CONCAT")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("substring")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("SUBSTRING")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("replace")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("REPLACE")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("trim")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("TRIM")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("upper")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("UPPER")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("lower")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("LOWER")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("now()")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("NOW()")])])])])]),t._v(" "),s("p",[t._v("由于各种数据库的函数的差异极大，sqala没有内置其他的SQL函数，我们同样可以使用"),s("code",[t._v("sqlFunction")]),t._v("注解创建函数。")]),t._v(" "),s("p",[t._v("我们以MySQL的"),s("code",[t._v("LEFT")]),t._v("函数为例：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@sqlFunction")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LEFT"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" left"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("String")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("\n")])])]),s("p",[t._v("注解"),s("code",[t._v("sqlFunction")]),t._v("标记函数为SQL函数，注解的参数是SQL函数名称，由于这类方法仅在编译期读取并转换为SQL表达式，因此无需编写实际的方法体。")]),t._v(" "),s("p",[t._v("这样我们就可以使用它构建查询了：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" left"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("函数类型的表达式当然也可以嵌套调用：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" left"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("left"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"聚合函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#聚合函数"}},[t._v("#")]),t._v(" 聚合函数")]),t._v(" "),s("p",[t._v("sqala内置了几个常用的SQL标准聚合函数：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("函数名称")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("对应SQL函数")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("count()")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("COUNT(*)")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("countDistinct(expr)")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("COUNT(DISTINCT x)")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("sum(expr)")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("SUM(x)")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("max(expr)")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("MAX(x)")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("min(expr)")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("MIN(x)")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("avg(expr)")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("AVG(x)")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("anyValue(expr)")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("ANY_VALUE(x)")])])])])]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" s "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("聚合函数也可以和其他表达式组合：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("聚合函数不可嵌套调用：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 编译错误")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"特殊聚合函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#特殊聚合函数"}},[t._v("#")]),t._v(" 特殊聚合函数")]),t._v(" "),s("h4",{attrs:{id:"percentiledisc和percentilecont"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#percentiledisc和percentilecont"}},[t._v("#")]),t._v(" percentileDisc和percentileCont")]),t._v(" "),s("p",[t._v("sqala支持两个特殊的数值聚合函数"),s("code",[t._v("percentileDisc")]),t._v("和"),s("code",[t._v("percentileCont")]),t._v("，对应到数据库的"),s("code",[t._v("PERCENTILE_DIST")]),t._v("和"),s("code",[t._v("PERCENTILE_CONT")]),t._v("函数。")]),t._v(" "),s("p",[t._v("用法如下：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" \n            percentileDisc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" withinGroup "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("asc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("第一个参数接收一个"),s("code",[t._v("Double")]),t._v("值；")]),t._v(" "),s("p",[t._v("第二个参数"),s("code",[t._v("withinGroup")]),t._v("接收一个排序规则，排序字段必须是数值类型。")]),t._v(" "),s("p",[s("strong",[t._v("MySQL、SQLite等数据库暂不支持此函数。")])]),t._v(" "),s("h4",{attrs:{id:"stringagg"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#stringagg"}},[t._v("#")]),t._v(" stringAgg")]),t._v(" "),s("p",[t._v("sqala支持特殊的字符串聚合函数"),s("code",[t._v("stringAgg")]),t._v("和"),s("code",[t._v("groupConcat")]),t._v("，两个方法的实质内容完全一致，作用是将字符串一次拼接，用法如下：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" \n            stringAgg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('","')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("asc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("第一个参数是一个字符串表达式；")]),t._v(" "),s("p",[t._v("第二个参数是"),s("code",[t._v("String")]),t._v("值，为分隔符；")]),t._v(" "),s("p",[t._v("后续是若干个排序规则，可省略。")]),t._v(" "),s("p",[t._v("sqala对此函数进行了特殊方言适配，规则如下：")]),t._v(" "),s("p",[t._v("在PostgreSQL或SQLServer中，生成"),s("code",[t._v("STRING_AGG")]),t._v("函数；")]),t._v(" "),s("p",[t._v("在MySQL中，生成"),s("code",[t._v("GROUP_CONCAT")]),t._v("函数，并将分隔符置于"),s("code",[t._v("SEPARATOR")]),t._v("关键字之后；")]),t._v(" "),s("p",[t._v("在SQLite中，生成"),s("code",[t._v("GROUP_CONCAT")]),t._v("函数；")]),t._v(" "),s("p",[t._v("在Oracle或DB2中，生成"),s("code",[t._v("LISTAGG")]),t._v("函数，并将排序规则放入"),s("code",[t._v("WITHIN GROUP")]),t._v("子句中。")]),t._v(" "),s("h4",{attrs:{id:"grouping"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#grouping"}},[t._v("#")]),t._v(" grouping")]),t._v(" "),s("p",[t._v("sqala支持"),s("code",[t._v("grouping")]),t._v("聚合函数，对应到数据库的"),s("code",[t._v("GROUPING")]),t._v("函数，用于区分哪些表达式参与了当前分组，在"),s("code",[t._v("GROUP BY CUBE")]),t._v("等复杂分组下且被分组表达式可能有空值的场景十分有用，其参数为若干个分组表达式：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("groupBy p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" \n            grouping"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("如果参数不是分组表达式，则会产生编译错误。")]),t._v(" "),s("p",[s("strong",[t._v("请注意：对于"),s("code",[t._v("GROUPING")]),t._v("函数，MySQL数据库限制其必须在"),s("code",[t._v("GROUP BY ROLLUP")]),t._v("或"),s("code",[t._v("GROUP BY GROUPING SETS")]),t._v("的查询中使用；SQLite数据库不支持此函数，sqala不对以上情况进行编译期检查。")])]),t._v(" "),s("h3",{attrs:{id:"自定义聚合函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义聚合函数"}},[t._v("#")]),t._v(" 自定义聚合函数")]),t._v(" "),s("p",[t._v("除了sqala内置的聚合函数外，我们可以轻易地自定义聚合函数：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("sqala"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("static"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dsl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@sqlAgg")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"FUNCTION_NAME"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" functionDistinct"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sortBy"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Sort"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" withinGroup"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Sort"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("\n")])])]),s("p",[t._v("与自定义函数类似，但使用"),s("code",[t._v("sqlAgg")]),t._v("注解定义SQL聚合函数。")]),t._v(" "),s("p",[t._v("自定义聚合函数遵循以下约定：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[t._v("1. 如果参数名为`sortBy`，则会生成聚合函数的`ORDER BY`子句。\n2. 如果参数名为`withinGroup`，则会生成聚合函数的`WITHIN GROUP`子句。\n3. 如果参数名为`filter`，则会生成聚合函数的`FILTER`子句。\n4. 如果方法名以`Distinct`结尾，则对应到`DISTINCT`的聚合函数。\n")])])]),s("h2",{attrs:{id:"窗口函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#窗口函数"}},[t._v("#")]),t._v(" 窗口函数")]),t._v(" "),s("p",[t._v("sqala支持下面几个分析函数：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("函数名称")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("对应SQL函数")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("rank()")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("RANK()")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("denseRank()")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("DENSE_RANK()")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("percentRank()")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("PERCENT_RANK()")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("rowNumber()")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("ROW_NUMBER()")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("lag")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("LAG(x, n, default)")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("lead")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("LEAD(x, n, default)")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("ntile(n)")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("NTILE(n)")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("firstValue")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("FIRST_VALUE(x)")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("lastValue")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("LAST_VALUE(x)")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("nthValue")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("NTH_VALUE(x)")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("cumeDist()")])]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("CUME_DIST()")])])])])]),t._v(" "),s("p",[t._v("在分析函数或聚合函数之后调用"),s("code",[t._v("over")]),t._v("，可以生成窗口函数表达式，可以使用"),s("code",[t._v("partitionBy")]),t._v("及"),s("code",[t._v("sortBy")]),t._v("，"),s("code",[t._v("partitionBy")]),t._v("的参数是若干表达式，"),s("code",[t._v("sortBy")]),t._v("的参数是若干表达式生成的排序规则：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" \n        rank"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" over "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("partitionBy "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("birthday"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" sortBy "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("asc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("窗口函数的参数可以为空：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" \n        rank"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" over "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("窗口函数的参数可以仅有"),s("code",[t._v("sortBy")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" \n        rank"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" over "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sortBy "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("asc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("sqala支持窗口函数的框架，使用"),s("code",[t._v("rowsBetween")]),t._v("、"),s("code",[t._v("rangeBetween")]),t._v("、"),s("code",[t._v("groupsBetween")]),t._v("生成一个框架，以上方法均有两个参数，可能为：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("参数")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("currentRow")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("unboundedPreceding")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("unboundedFollowing")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("n.preceding")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[s("code",[t._v("n.following")])])])])]),t._v(" "),s("p",[t._v("比如：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("scala"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("language"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postfixOps")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" \n        rank"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" over "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("partitionBy "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("birthday"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" sortBy "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("asc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" rowsBetween "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("currentRow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" preceding"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("我们可以使用"),s("code",[t._v("sqlWindow")]),t._v("注解创建窗口函数，规则与"),s("code",[t._v("sqlFunction")]),t._v("一致。")]),t._v(" "),s("h2",{attrs:{id:"条件表达式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#条件表达式"}},[t._v("#")]),t._v(" 条件表达式")]),t._v(" "),s("p",[t._v("sqala将Scala3的"),s("code",[t._v("if")]),t._v("表达式翻译为SQL的"),s("code",[t._v("CASE WHEN")]),t._v("表达式：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gender "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" Gender"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Male then "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gender "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" Gender"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Female then "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),s("p",[t._v("可以在"),s("code",[t._v("then")]),t._v("中返回"),s("code",[t._v("Option")]),t._v("类型的值：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gender "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" Gender"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Male then Some"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gender "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" Gender"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Female then Some"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" None\n")])])]),s("p",[t._v("将Scala3的"),s("code",[t._v("match")]),t._v("表达式翻译为SQL的"),s("code",[t._v("CASE x WHEN")]),t._v("表达式：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("People"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" p "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v("\n        p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("gender "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("match")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" Gender"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Male "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" _ "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),s("p",[s("strong",[t._v("暂不支持带有if守卫的match表达式。")])]),t._v(" "),s("h2",{attrs:{id:"json操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#json操作"}},[t._v("#")]),t._v(" JSON操作")]),t._v(" "),s("p",[t._v("sqala支持"),s("code",[t._v("->")]),t._v("和"),s("code",[t._v("->>")]),t._v("两个JSON操作符，语义与MySQL和PostgreSQL一致：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("A"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" \n        a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"a"')]),t._v("\n")])])]),s("p",[t._v("对于JSON操作，需要将字段类型指定为"),s("code",[t._v("sqala.dsl.Json")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("sqala"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("static"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dsl"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" A"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("其定义为"),s("code",[t._v("opaque type Json = String")]),t._v("。我们可以使用其"),s("code",[t._v("toString")]),t._v("方法转换为字符串。")]),t._v(" "),s("h2",{attrs:{id:"时间操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#时间操作"}},[t._v("#")]),t._v(" 时间操作")]),t._v(" "),s("p",[t._v("我们可以使用"),s("code",[t._v("interval")]),t._v("方法来对时间进行操作：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("scala"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("language"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postfixOps")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("A"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" \n        a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("date "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" interval"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" day"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" interval"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" month"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("code",[t._v("interval")]),t._v("的第一个参数是"),s("code",[t._v("Double")]),t._v("类型，第二个参数是时间单位，sqala支持以下时间单位：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("单位")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("含义")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("year")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("年")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("month")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("月")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("week")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("周")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("day")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("日")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("hour")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("时")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("minute")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("分")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("second")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("秒")])])])]),t._v(" "),s("p",[t._v("sqala会在生成SQL时自动进行方言转换，比如在SQLServer中会将其转换成"),s("code",[t._v("DATEADD")]),t._v("函数，在SQLite中会将其转换成"),s("code",[t._v("DATETIME")]),t._v("函数，其他数据库将会生成不同的"),s("code",[t._v("INTERVAL")]),t._v("表达式方言。")]),t._v(" "),s("p",[t._v("sqala支持字符串插值器"),s("code",[t._v("timestamp")]),t._v("和"),s("code",[t._v("date")]),t._v("，将字符串转变为数据库的时间字面量，对应的类型分别为"),s("code",[t._v("LocalDateTime")]),t._v("和"),s("code",[t._v("LocalDate")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" time1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token id function"}},[t._v("timestamp")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2020-01-01 00:00:00"')])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" time2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token id function"}},[t._v("date")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2020-01-01"')])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("A"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("date1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" time1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("date2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" time2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("在Sqlite和SQLServer中会分别转变为日期函数和"),s("code",[t._v("CAST")]),t._v("表达式，其他数据库则会生成时间字面量。")]),t._v(" "),s("p",[t._v("我们可以使用"),s("code",[t._v("extract")]),t._v("取出时间的某个部分：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("scala"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("language"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postfixOps")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("A"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" \n        extract"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("date year"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("SQLServer中会将其转换成"),s("code",[t._v("DATEPART")]),t._v("函数，其他的数据库会生成"),s("code",[t._v("EXTRACT")]),t._v("表达式。")]),t._v(" "),s("p",[t._v("可以使用"),s("code",[t._v("extract")]),t._v("操作取出时间差值的某个部分：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("scala"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("language"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postfixOps")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" \n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("A"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" \n        extract"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("date1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("date2 day"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"类型转换"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#类型转换"}},[t._v("#")]),t._v(" 类型转换")]),t._v(" "),s("p",[t._v("我们可以使用"),s("code",[t._v("as")]),t._v("方法将表达式转换类型：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("A"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" \n        a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("as"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("sqala会自动进行数据库方言适配。")]),t._v(" "),s("h2",{attrs:{id:"数组谓词"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数组谓词"}},[t._v("#")]),t._v(" 数组谓词")]),t._v(" "),s("p",[t._v("sqala支持"),s("code",[t._v("any")]),t._v("和"),s("code",[t._v("all")]),t._v("两个操作配合集合，作为谓词使用，以PostgreSQL查询为例，比如我们有：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" Task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" userIds"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("其中"),s("code",[t._v("userIds")]),t._v("字段是使用"),s("code",[t._v(",")]),t._v("分隔的用户ID列表，我们想查询某个用户的所有任务，可以先自定义SQL函数"),s("code",[t._v("stringToArray")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@sqlFunction")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"STRING_TO_ARRAY"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" stringToArray"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" List"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" compileTimeOnly\n")])])]),s("p",[t._v("然后我们可以使用"),s("code",[t._v("any")]),t._v("查询：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" userId"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 假设是外界传参")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" userIdString "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" userId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("toString\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Task"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" userIdString "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" any"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stringToArray"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("userIds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("我们也可以把"),s("code",[t._v("in")]),t._v("谓词变为"),s("code",[t._v("any")]),t._v("数组谓词：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("A"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("in"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("List"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("等价于：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("A"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" any"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("List"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("strong",[t._v("需要注意的是，虽然数组是SQL标准语法，但目前只有PostgreSQL和H2等少数数据库支持此语法。")])]),t._v(" "),s("h2",{attrs:{id:"自定义二元运算符"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义二元运算符"}},[t._v("#")]),t._v(" 自定义二元运算符")]),t._v(" "),s("p",[t._v("sqala支持自定义非标准二元运算符，以MySQL的"),s("code",[t._v("RLIKE")]),t._v("为例：")]),t._v(" "),s("div",{staticClass:"language-scala extra-class"},[s("pre",{pre:!0,attrs:{class:"language-scala"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extension")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@sqlBinaryOperator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"RLIKE"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" rlike"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("y"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" QueryContext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Boolean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" compileTimeOnly\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" q "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" queryContext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("A"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("filter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("=>")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rlike"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);