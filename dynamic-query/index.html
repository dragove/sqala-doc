<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>动态查询构造 | sqala</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="类型安全的Scala3查询库">
    
    <link rel="preload" href="/sqala-doc/assets/css/0.styles.05ece7a7.css" as="style"><link rel="preload" href="/sqala-doc/assets/js/app.9bf302b3.js" as="script"><link rel="preload" href="/sqala-doc/assets/js/2.58244656.js" as="script"><link rel="preload" href="/sqala-doc/assets/js/1.6ba70183.js" as="script"><link rel="preload" href="/sqala-doc/assets/js/24.28b07f74.js" as="script"><link rel="prefetch" href="/sqala-doc/assets/js/10.0720960b.js"><link rel="prefetch" href="/sqala-doc/assets/js/11.2a97faa3.js"><link rel="prefetch" href="/sqala-doc/assets/js/12.6b9ed61d.js"><link rel="prefetch" href="/sqala-doc/assets/js/13.ebfb1f42.js"><link rel="prefetch" href="/sqala-doc/assets/js/14.3e65117c.js"><link rel="prefetch" href="/sqala-doc/assets/js/15.2d87bde7.js"><link rel="prefetch" href="/sqala-doc/assets/js/16.9ca9aae8.js"><link rel="prefetch" href="/sqala-doc/assets/js/17.3dbcb51f.js"><link rel="prefetch" href="/sqala-doc/assets/js/18.4c170722.js"><link rel="prefetch" href="/sqala-doc/assets/js/19.d8afd0ae.js"><link rel="prefetch" href="/sqala-doc/assets/js/20.10e47ab9.js"><link rel="prefetch" href="/sqala-doc/assets/js/21.0ad1d6a3.js"><link rel="prefetch" href="/sqala-doc/assets/js/22.b7c97fbe.js"><link rel="prefetch" href="/sqala-doc/assets/js/23.cac91773.js"><link rel="prefetch" href="/sqala-doc/assets/js/25.4285c857.js"><link rel="prefetch" href="/sqala-doc/assets/js/26.6bc8b23d.js"><link rel="prefetch" href="/sqala-doc/assets/js/27.d15bd4b2.js"><link rel="prefetch" href="/sqala-doc/assets/js/28.83043ead.js"><link rel="prefetch" href="/sqala-doc/assets/js/29.6f1587b4.js"><link rel="prefetch" href="/sqala-doc/assets/js/3.bc6bba9e.js"><link rel="prefetch" href="/sqala-doc/assets/js/4.45665f8a.js"><link rel="prefetch" href="/sqala-doc/assets/js/5.7098d77a.js"><link rel="prefetch" href="/sqala-doc/assets/js/6.0c0a0f39.js"><link rel="prefetch" href="/sqala-doc/assets/js/7.6a854e57.js"><link rel="prefetch" href="/sqala-doc/assets/js/vendors~docsearch.5e19b665.js">
    <link rel="stylesheet" href="/sqala-doc/assets/css/0.styles.05ece7a7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/sqala-doc/" class="home-link router-link-active"><!----> <span class="site-name">sqala</span></a> <div class="links"><!----> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/sqala-doc/metadata/" class="sidebar-link">元数据配置</a></li><li><a href="/sqala-doc/database/" class="sidebar-link">数据库交互</a></li><li><a href="/sqala-doc/query/" class="sidebar-link">查询</a></li><li><a href="/sqala-doc/expr/" class="sidebar-link">表达式</a></li><li><a href="/sqala-doc/update/" class="sidebar-link">增删改</a></li><li><a href="/sqala-doc/dynamic-query/" aria-current="page" class="active sidebar-link">动态查询构造</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/sqala-doc/dynamic-query/#select" class="sidebar-link">SELECT</a></li><li class="sidebar-sub-header"><a href="/sqala-doc/dynamic-query/#from" class="sidebar-link">FROM</a></li><li class="sidebar-sub-header"><a href="/sqala-doc/dynamic-query/#where" class="sidebar-link">WHERE</a></li><li class="sidebar-sub-header"><a href="/sqala-doc/dynamic-query/#join" class="sidebar-link">JOIN</a></li><li class="sidebar-sub-header"><a href="/sqala-doc/dynamic-query/#group-by" class="sidebar-link">GROUP BY</a></li><li class="sidebar-sub-header"><a href="/sqala-doc/dynamic-query/#order-by" class="sidebar-link">ORDER BY</a></li><li class="sidebar-sub-header"><a href="/sqala-doc/dynamic-query/#limit" class="sidebar-link">LIMIT</a></li><li class="sidebar-sub-header"><a href="/sqala-doc/dynamic-query/#union" class="sidebar-link">UNION</a></li><li class="sidebar-sub-header"><a href="/sqala-doc/dynamic-query/#子查询" class="sidebar-link">子查询</a></li><li class="sidebar-sub-header"><a href="/sqala-doc/dynamic-query/#表达式" class="sidebar-link">表达式</a></li><li class="sidebar-sub-header"><a href="/sqala-doc/dynamic-query/#生成sql" class="sidebar-link">生成SQL</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="动态查询构造"><a href="#动态查询构造" class="header-anchor">#</a> 动态查询构造</h1> <p>之前介绍的都是偏向于编译期确定的查询构造，sqala可以提供类型安全以及自动反序列化的能力，但是在某些应用里（比如用户可定制的报表系统），执行的查询并不能在编译期事先知道，我们甚至在编译期不知道数据中有什么表，表中有什么字段，为了应对这种场景，sqala提供了一套动态查询DSL。</p> <p>既然编译期不知道有什么样的表，自然也不可能编写出对应的实体类，所以我们使用<code>table</code>、<code>col</code>两个方法来动态创建表和字段，并且带入到查询里，动态查询DSL需要<code>import sqala.dynamic.*</code>：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">sqala<span class="token punctuation">.</span>dynamic<span class="token punctuation">.</span></span><span class="token operator">*</span>

<span class="token keyword">val</span> q <span class="token operator">=</span> select <span class="token punctuation">(</span>List<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> col<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> from table<span class="token punctuation">(</span><span class="token string">&quot;t&quot;</span><span class="token punctuation">)</span> where col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
</code></pre></div><p><code>col</code>方法不仅可以填写简单的字符串，实际上，我们可以把一个SQL片段传进来，sqala会启用一个SQL解析器，并将其转换成SQL的语法树：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> q <span class="token operator">=</span> select <span class="token punctuation">(</span>List<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> col<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> from table<span class="token punctuation">(</span><span class="token string">&quot;t&quot;</span><span class="token punctuation">)</span> where col<span class="token punctuation">(</span><span class="token string">&quot;a = 1&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> col<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
</code></pre></div><p>下面我们来详细了解sqala的动态查询构造器。</p> <h2 id="select"><a href="#select" class="header-anchor">#</a> SELECT</h2> <p>使用<code>select</code>方法创建一个<code>SELECT</code>语句：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> s <span class="token operator">=</span> select<span class="token punctuation">(</span>List<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> col<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span> as <span class="token string">&quot;col&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>链式调用<code>select</code>会在生成SQL时依次拼接。</p> <p>假设我们有一个运行时获取的字段列表，需要放入查询中，可以这样来编写：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token comment">// 假设列表是运行时获取的</span>
<span class="token keyword">val</span> colList<span class="token operator">:</span> List<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> List<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">val</span> s <span class="token operator">=</span> select<span class="token punctuation">(</span>colList<span class="token punctuation">.</span>map<span class="token punctuation">(</span>col<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="from"><a href="#from" class="header-anchor">#</a> FROM</h2> <p>使用<code>from</code>方法配合<code>table</code>生成<code>FROM</code>子句：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> s <span class="token operator">=</span> select <span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> col<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> from table<span class="token punctuation">(</span><span class="token string">&quot;t&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="where"><a href="#where" class="header-anchor">#</a> WHERE</h2> <p>使用<code>where</code>方法生成<code>WHERE</code>子句：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> s <span class="token operator">=</span> select <span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> col<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> from table<span class="token punctuation">(</span><span class="token string">&quot;t&quot;</span><span class="token punctuation">)</span> where col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>
</code></pre></div><p>假设我们有一个运行时确定的值列表，我们需要在查询中使用<code>OR</code>拼接，可以这样编写：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token comment">// 假设列表是运行时获取的</span>
<span class="token keyword">val</span> values <span class="token operator">=</span> List<span class="token punctuation">(</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;z&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> condition <span class="token operator">=</span> values<span class="token punctuation">.</span>map<span class="token punctuation">(</span>v <span class="token keyword">=&gt;</span> col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> v<span class="token punctuation">)</span><span class="token punctuation">.</span>reduce<span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> x <span class="token operator">||</span> y<span class="token punctuation">)</span>
<span class="token keyword">val</span> s <span class="token operator">=</span> select <span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> from table<span class="token punctuation">(</span><span class="token string">&quot;t&quot;</span><span class="token punctuation">)</span> where condition
</code></pre></div><p>生成的SQL形如：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> a <span class="token keyword">FROM</span> t <span class="token keyword">WHERE</span> a <span class="token operator">=</span> <span class="token string">'x'</span> <span class="token operator">OR</span> a <span class="token operator">=</span> <span class="token string">'y'</span> <span class="token operator">OR</span> a <span class="token operator">=</span> <span class="token string">'z'</span>
</code></pre></div><p>链式调用<code>where</code>会使用<code>AND</code>拼接条件。</p> <h2 id="join"><a href="#join" class="header-anchor">#</a> JOIN</h2> <p>使用<code>join</code>、<code>leftJoin</code>、<code>rightJoin</code>、<code>fullJoin</code>配合<code>on</code>方法，生成一个<code>JOIN</code>表，然后放入<code>from</code>中：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> t <span class="token operator">=</span> table<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span> join table<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span> on col<span class="token punctuation">(</span><span class="token string">&quot;a.x&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> col<span class="token punctuation">(</span><span class="token string">&quot;b.y&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> s <span class="token operator">=</span> select <span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> from t
</code></pre></div><h2 id="group-by"><a href="#group-by" class="header-anchor">#</a> GROUP BY</h2> <p>使用<code>groupBy</code>方法生成<code>GROUP BY</code>子句：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> s <span class="token operator">=</span> select <span class="token punctuation">(</span>List<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sum<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> from table<span class="token punctuation">(</span><span class="token string">&quot;t&quot;</span><span class="token punctuation">)</span> groupBy List<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>链式调用<code>groupBy</code>会依次拼接。</p> <p>使用<code>having</code>方法生成<code>HAVING</code>子句：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> s <span class="token operator">=</span> select <span class="token punctuation">(</span>List<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sum<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> from table<span class="token punctuation">(</span><span class="token string">&quot;t&quot;</span><span class="token punctuation">)</span> groupBy List<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> having sum<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span>
</code></pre></div><h2 id="order-by"><a href="#order-by" class="header-anchor">#</a> ORDER BY</h2> <p>使用<code>orderBy</code>方法生成<code>GROUP BY</code>子句，配合表达式的<code>asc</code>、<code>desc</code>方法使用：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> s <span class="token operator">=</span> select <span class="token punctuation">(</span>List<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> col<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> from table<span class="token punctuation">(</span><span class="token string">&quot;t&quot;</span><span class="token punctuation">)</span> orderBy List<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>asc<span class="token punctuation">,</span> col<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>desc<span class="token punctuation">)</span>
</code></pre></div><p>链式调用<code>orderBy</code>会依次拼接。</p> <h2 id="limit"><a href="#limit" class="header-anchor">#</a> LIMIT</h2> <p>使用<code>limit</code>和<code>offset</code>方法创建<code>LIMIT</code>子句：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> s <span class="token operator">=</span> select <span class="token punctuation">(</span>List<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> col<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> from table<span class="token punctuation">(</span><span class="token string">&quot;t&quot;</span><span class="token punctuation">)</span> limit <span class="token number">10</span> offset <span class="token number">10</span>
</code></pre></div><p>生成SQL时会根据数据库方言分别生成不同的SQL。</p> <h2 id="union"><a href="#union" class="header-anchor">#</a> UNION</h2> <p>使用<code>union</code>、<code>unionAll</code>、<code>except</code>、<code>exceptAll</code>、<code>intersect</code>、<code>intersectAll</code>方法生成集合查询：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> s1 <span class="token operator">=</span> select <span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> from table<span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> s2 <span class="token operator">=</span> select <span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> from table<span class="token punctuation">(</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> s <span class="token operator">=</span> s1 union s2
</code></pre></div><h2 id="子查询"><a href="#子查询" class="header-anchor">#</a> 子查询</h2> <p>子查询可以作为表达式的一部分出现，比如：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> subQuery <span class="token operator">=</span> select <span class="token punctuation">(</span>max<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> from table<span class="token punctuation">(</span><span class="token string">&quot;t&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">val</span> s <span class="token operator">=</span> select <span class="token punctuation">(</span>List<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> from table<span class="token punctuation">(</span><span class="token string">&quot;t&quot;</span><span class="token punctuation">)</span> where col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> subQuery
</code></pre></div><p>此外也支持<code>IN</code>、<code>ANY</code>、<code>SOME</code>、<code>ALL</code>、<code>EXISTS</code>等子查询相关谓词。</p> <p><code>FROM</code>中的子查询，需要我们使用<code>as</code>方法给字段和查询起别名，然后再次引用：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> subQuery <span class="token operator">=</span> select <span class="token punctuation">(</span>List<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> col<span class="token punctuation">(</span><span class="token string">&quot;y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> from table<span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span> as <span class="token string">&quot;q1&quot;</span>

<span class="token keyword">val</span> q <span class="token operator">=</span> select <span class="token punctuation">(</span>List<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;q1.x&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> col<span class="token punctuation">(</span><span class="token string">&quot;q1.y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> from subQuery
</code></pre></div><h2 id="表达式"><a href="#表达式" class="header-anchor">#</a> 表达式</h2> <p>动态查询构造器的表达式，大部分的用法都与静态查询的<a href="https://wz7982.github.io/sqala-doc/expr/" target="_blank" rel="noopener noreferrer">表达式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>部分类似，可以参照其中的说明，不同的是<code>CASE</code>表达式的用法，其是为了方便运行时动态构建<code>CASE</code>：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> caseExpr <span class="token operator">=</span> `<span class="token keyword">case</span>`<span class="token punctuation">(</span>List<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">-&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span> col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">-&gt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre></div><p>为了在高度动态的查询构造场景中保持易用性，动态查询的表达式并没有采用严格的类型安全设计。</p> <h2 id="生成sql"><a href="#生成sql" class="header-anchor">#</a> 生成SQL</h2> <p>在创建好查询之后，如果我们要发送给JDBC处理，还需要获取生成的SQL，我们可以使用<code>sql</code>方法配合<code>sqala.jdbc</code>中的<code>Dialect</code>生成SQL：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">sqala<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>Dialect

<span class="token keyword">val</span> s <span class="token operator">=</span> select <span class="token punctuation">(</span>List<span class="token punctuation">(</span>col<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> col<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> from table<span class="token punctuation">(</span><span class="token string">&quot;t&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> sql<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> Array<span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span> s<span class="token punctuation">.</span>sql<span class="token punctuation">(</span>MySqlDialect<span class="token punctuation">)</span>
</code></pre></div><p><code>sql</code>方法返回一个二元组，第一项是生成的SQL语句，第二个参数是其中的参数。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/sqala-doc/update/" class="prev">
        增删改
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/sqala-doc/assets/js/app.9bf302b3.js" defer></script><script src="/sqala-doc/assets/js/2.58244656.js" defer></script><script src="/sqala-doc/assets/js/1.6ba70183.js" defer></script><script src="/sqala-doc/assets/js/24.28b07f74.js" defer></script>
  </body>
</html>
