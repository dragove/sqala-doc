<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>方法名构建查询 | sqala</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="类型安全的Scala3查询库">
    
    <link rel="preload" href="/sqala-doc/assets/css/0.styles.05ece7a7.css" as="style"><link rel="preload" href="/sqala-doc/assets/js/app.9bf302b3.js" as="script"><link rel="preload" href="/sqala-doc/assets/js/2.58244656.js" as="script"><link rel="preload" href="/sqala-doc/assets/js/1.6ba70183.js" as="script"><link rel="preload" href="/sqala-doc/assets/js/27.d15bd4b2.js" as="script"><link rel="prefetch" href="/sqala-doc/assets/js/10.0720960b.js"><link rel="prefetch" href="/sqala-doc/assets/js/11.2a97faa3.js"><link rel="prefetch" href="/sqala-doc/assets/js/12.6b9ed61d.js"><link rel="prefetch" href="/sqala-doc/assets/js/13.ebfb1f42.js"><link rel="prefetch" href="/sqala-doc/assets/js/14.3e65117c.js"><link rel="prefetch" href="/sqala-doc/assets/js/15.2d87bde7.js"><link rel="prefetch" href="/sqala-doc/assets/js/16.9ca9aae8.js"><link rel="prefetch" href="/sqala-doc/assets/js/17.3dbcb51f.js"><link rel="prefetch" href="/sqala-doc/assets/js/18.4c170722.js"><link rel="prefetch" href="/sqala-doc/assets/js/19.d8afd0ae.js"><link rel="prefetch" href="/sqala-doc/assets/js/20.10e47ab9.js"><link rel="prefetch" href="/sqala-doc/assets/js/21.0ad1d6a3.js"><link rel="prefetch" href="/sqala-doc/assets/js/22.b7c97fbe.js"><link rel="prefetch" href="/sqala-doc/assets/js/23.cac91773.js"><link rel="prefetch" href="/sqala-doc/assets/js/24.28b07f74.js"><link rel="prefetch" href="/sqala-doc/assets/js/25.4285c857.js"><link rel="prefetch" href="/sqala-doc/assets/js/26.6bc8b23d.js"><link rel="prefetch" href="/sqala-doc/assets/js/28.83043ead.js"><link rel="prefetch" href="/sqala-doc/assets/js/29.6f1587b4.js"><link rel="prefetch" href="/sqala-doc/assets/js/3.bc6bba9e.js"><link rel="prefetch" href="/sqala-doc/assets/js/4.45665f8a.js"><link rel="prefetch" href="/sqala-doc/assets/js/5.7098d77a.js"><link rel="prefetch" href="/sqala-doc/assets/js/6.0c0a0f39.js"><link rel="prefetch" href="/sqala-doc/assets/js/7.6a854e57.js"><link rel="prefetch" href="/sqala-doc/assets/js/vendors~docsearch.5e19b665.js">
    <link rel="stylesheet" href="/sqala-doc/assets/css/0.styles.05ece7a7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/sqala-doc/" class="home-link router-link-active"><!----> <span class="site-name">sqala</span></a> <div class="links"><!----> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/sqala-doc/metadata/" class="sidebar-link">元数据配置</a></li><li><a href="/sqala-doc/database/" class="sidebar-link">数据库交互</a></li><li><a href="/sqala-doc/query/" class="sidebar-link">查询</a></li><li><a href="/sqala-doc/expr/" class="sidebar-link">表达式</a></li><li><a href="/sqala-doc/update/" class="sidebar-link">增删改</a></li><li><a href="/sqala-doc/dynamic-query/" class="sidebar-link">动态查询构造</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="方法名构建查询"><a href="#方法名构建查询" class="header-anchor">#</a> 方法名构建查询</h1> <p>现代软件的查询都倾向于简单，简单的单表查询有助于获得更高的性能和更好的并发能力，这样的查询如果使用sqala的查询构造器，会稍显繁琐，因此，sqala效仿Spring Data JPA，支持使用方法名自动生成查询，但是与前者不同的是，我们无需预先定义Repository接口，而是借助Scala的<code>Dynaimc</code>能力来动态调用方法，并且，sqala支持从方法名中自动推断出参数的类型，因此它也是类型安全的。</p> <p>这样的方法名查询由<code>namedQuery</code>构建：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">import</span> <span class="token namespace">sqala<span class="token punctuation">.</span>compiletime<span class="token punctuation">.</span></span><span class="token operator">*</span>

<span class="token keyword">val</span> q <span class="token operator">=</span> namedQuery<span class="token punctuation">(</span>tablePeople<span class="token punctuation">)</span><span class="token punctuation">.</span>findByIdAndName<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;小黑&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>sqala从上面的<code>findByIdAndName</code>方法名中推断出参数类型为<code>(Int, String)</code>，所以如果参数类型不符合要求，无法通过编译：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token comment">// 编译错误</span>
<span class="token keyword">val</span> q <span class="token operator">=</span> namedQuery<span class="token punctuation">(</span>tablePeople<span class="token punctuation">)</span><span class="token punctuation">.</span>findByIdAndName<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div><p>由于推断出的参数是元组类型，因此单参数的情况下，我们需要传入一个一元组：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> q <span class="token operator">=</span> namedQuery<span class="token punctuation">(</span>tablePeople<span class="token punctuation">)</span><span class="token punctuation">.</span>findById<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span><span class="token operator">:</span> EmptyTuple<span class="token punctuation">)</span>
</code></pre></div><p>以下是关键字列表、对应的SQL运算符以及推断出来的参数类型（使用<code>col</code>指代实际的字段名，参数类型会依次拼接，最终生成一个元组类型）：</p> <table><thead><tr><th style="text-align:center;">关键字</th> <th style="text-align:center;">运算符</th> <th style="text-align:center;">参数类型</th></tr></thead> <tbody><tr><td style="text-align:center;">findBy</td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">And</td> <td style="text-align:center;">AND</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">Or</td> <td style="text-align:center;">OR</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">Col</td> <td style="text-align:center;">=</td> <td style="text-align:center;">col.type</td></tr> <tr><td style="text-align:center;">ColEquals</td> <td style="text-align:center;">=</td> <td style="text-align:center;">col.type</td></tr> <tr><td style="text-align:center;">ColIs</td> <td style="text-align:center;">=</td> <td style="text-align:center;">col.type</td></tr> <tr><td style="text-align:center;">ColGreaterThan</td> <td style="text-align:center;">&gt;</td> <td style="text-align:center;">col.type</td></tr> <tr><td style="text-align:center;">ColGreaterThanEqual</td> <td style="text-align:center;">&gt;=</td> <td style="text-align:center;">col.type</td></tr> <tr><td style="text-align:center;">ColLessThan</td> <td style="text-align:center;">&lt;</td> <td style="text-align:center;">col.type</td></tr> <tr><td style="text-align:center;">ColLessThanEqual</td> <td style="text-align:center;">&lt;=</td> <td style="text-align:center;">col.type</td></tr> <tr><td style="text-align:center;">ColNot</td> <td style="text-align:center;">&lt;&gt;</td> <td style="text-align:center;">col.type</td></tr> <tr><td style="text-align:center;">ColIn</td> <td style="text-align:center;">IN</td> <td style="text-align:center;">List[col.type]</td></tr> <tr><td style="text-align:center;">ColNotIn</td> <td style="text-align:center;">NOT IN</td> <td style="text-align:center;">List[col.type]</td></tr> <tr><td style="text-align:center;">ColLike</td> <td style="text-align:center;">LIKE '%?%'</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">ColNotLike</td> <td style="text-align:center;">NOT LIKE '%?%'</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">ColStartingWith</td> <td style="text-align:center;">LIKE '?%'</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">ColEndingWith</td> <td style="text-align:center;">LIKE '%?'</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">ColBetween</td> <td style="text-align:center;">BETWEEN</td> <td style="text-align:center;">(col.type, col.type)</td></tr> <tr><td style="text-align:center;">ColNotBetween</td> <td style="text-align:center;">NOT BETWEEN</td> <td style="text-align:center;">(col.type, col.type)</td></tr> <tr><td style="text-align:center;">ColIsNull</td> <td style="text-align:center;">IS NULL</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">ColIsNotNull</td> <td style="text-align:center;">IS NOT NULL</td> <td style="text-align:center;"></td></tr></tbody></table> <p><code>namedQuery</code>支持使用<code>OrderBy</code>来开启排序，方法名中需要在字段名后面添加<code>Asc</code>或<code>Desc</code>：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> q <span class="token operator">=</span> namedQuery<span class="token punctuation">(</span>tablePeople<span class="token punctuation">)</span><span class="token punctuation">.</span>findByIdOrderByIdAscNameDesc<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span><span class="token operator">:</span> EmptyTuple<span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/sqala-doc/assets/js/app.9bf302b3.js" defer></script><script src="/sqala-doc/assets/js/2.58244656.js" defer></script><script src="/sqala-doc/assets/js/1.6ba70183.js" defer></script><script src="/sqala-doc/assets/js/27.d15bd4b2.js" defer></script>
  </body>
</html>
